---
import BaseLayout from '../layouts/BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Hero from '../components/Hero.astro';
import About from '../components/About.astro';
import Skills from '../components/Skills.astro';
import Timeline from '../components/Timeline.astro';
import Projects from '../components/Projects.astro';
import Writing from '../components/Writing.astro';
import Contact from '../components/Contact.astro';
import Footer from '../components/Footer.astro';
---

<BaseLayout>
  <!-- Fixed aurora blob orbs — constant background, content scrolls over them -->
  <div class="bg-blobs" aria-hidden="true">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    <div class="blob blob-3"></div>
  </div>

  <!-- Custom cursor dot -->
  <div class="cursor-dot" id="cursorDot" aria-hidden="true"></div>

  <Nav />

  <!-- Back to top -->
  <button class="back-to-top" id="backToTop" aria-label="Back to top">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/>
    </svg>
  </button>

  <main>
    <Hero />
    <About />
    <Skills />
    <Timeline />
    <Projects />
    <Writing />
    <Contact />
  </main>
  <Footer />
</BaseLayout>

<style is:global>
  /* ── Fixed background blob orbs ─────────────────────────── */
  .bg-blobs {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
  }

  .blob {
    position: absolute;
    border-radius: 60% 40% 55% 45% / 50% 60% 40% 55%;
    filter: blur(100px);
    mix-blend-mode: var(--blob-blend);
    opacity: 0.3;
  }

  .blob-1 {
    width: 520px;
    height: 520px;
    background: var(--accent-1);
    top: -8%;
    left: -5%;
    animation: drift1 10s ease-in-out infinite alternate;
  }

  .blob-2 {
    width: 420px;
    height: 420px;
    background: var(--accent-2);
    top: 15%;
    right: -8%;
    animation: drift2 13s ease-in-out infinite alternate;
  }

  .blob-3 {
    width: 350px;
    height: 350px;
    background: var(--accent-3);
    top: 50%;
    left: 35%;
    animation: drift3 9s ease-in-out infinite alternate;
  }

  @keyframes drift1 {
    from { transform: translate(0, 0) scale(1);      border-radius: 60% 40% 55% 45% / 50% 60% 40% 55%; }
    to   { transform: translate(6%, 8%) scale(1.1);  border-radius: 45% 55% 40% 60% / 60% 40% 55% 45%; }
  }
  @keyframes drift2 {
    from { transform: translate(0, 0) scale(1);        border-radius: 55% 45% 60% 40% / 45% 55% 50% 50%; }
    to   { transform: translate(-5%, 10%) scale(0.95); border-radius: 40% 60% 45% 55% / 55% 45% 60% 40%; }
  }
  @keyframes drift3 {
    from { transform: translate(0, 0) scale(1);         border-radius: 50% 50% 40% 60% / 60% 40% 55% 45%; }
    to   { transform: translate(-8%, -6%) scale(1.08);  border-radius: 60% 40% 55% 45% / 45% 55% 40% 60%; }
  }

  @media (max-width: 640px) {
    .blob-1 { width: 300px; height: 300px; }
    .blob-2 { width: 250px; height: 250px; }
    .blob-3 { width: 200px; height: 200px; }
  }

  @media (prefers-reduced-motion: reduce) {
    .blob { animation: none; }
  }

  /* Custom cursor */
  @media (hover: hover) and (pointer: fine) {
    body { cursor: none; }
    a, button, [role="tab"] { cursor: none; }
  }

  .cursor-dot {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--accent-1);
    pointer-events: none;
    z-index: 9999;
    transform: translate(-50%, -50%);
    transition: transform 80ms ease, width 200ms ease, height 200ms ease, opacity 200ms ease, background 200ms ease;
    mix-blend-mode: difference;
  }

  @media (hover: hover) and (pointer: fine) {
    .cursor-dot { display: block; }
  }

  /* Back to top */
  .back-to-top {
    position: fixed;
    bottom: 2rem;
    right: 2rem;
    z-index: 90;
    width: 2.4rem;
    height: 2.4rem;
    border-radius: 999px;
    border: 1px solid var(--border);
    background: color-mix(in srgb, var(--surface) 80%, transparent);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    color: var(--fg);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: var(--shadow-md);
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 300ms ease, transform 300ms ease, color 200ms, border-color 200ms, box-shadow 200ms;
    pointer-events: none;
  }
  .back-to-top.visible {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
  .back-to-top:hover {
    color: var(--accent-1);
    border-color: var(--accent-1);
    box-shadow: 0 0 14px var(--accent-1-glow);
  }
</style>

<script>
  // Back to top
  const backToTop = document.getElementById('backToTop')!;
  window.addEventListener('scroll', () => {
    backToTop.classList.toggle('visible', window.scrollY > window.innerHeight * 0.5);
  }, { passive: true });
  backToTop.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

  // Custom cursor
  const dot = document.getElementById('cursorDot');
  if (dot && window.matchMedia('(hover: hover) and (pointer: fine)').matches) {
    let mouseX = 0, mouseY = 0;
    let dotX = 0, dotY = 0;

    window.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    }, { passive: true });

    function loop() {
      dotX += (mouseX - dotX) * 0.18;
      dotY += (mouseY - dotY) * 0.18;
      dot!.style.left = `${dotX}px`;
      dot!.style.top  = `${dotY}px`;
      requestAnimationFrame(loop);
    }
    loop();

    // Grow on interactive elements
    document.querySelectorAll('a, button, [role="tab"]').forEach((el) => {
      el.addEventListener('mouseenter', () => {
        dot!.style.width  = '24px';
        dot!.style.height = '24px';
        dot!.style.opacity = '0.6';
      });
      el.addEventListener('mouseleave', () => {
        dot!.style.width  = '10px';
        dot!.style.height = '10px';
        dot!.style.opacity = '1';
      });
    });
  }
</script>
